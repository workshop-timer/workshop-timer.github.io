<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>Design Sprint || Workshop timer</title>
	 <link rel="stylesheet" href="style.css">

</head>
<body>

<h1>Workshop timer</h1>
<div id="timer_container">
	<div id="timer_out">Time is up</div>
	<div id="browser_note">You know... this timer works better on Chrome</div>
	<div id="timer_count">0min 0sek</div>
	<div id="pie"></div>
	<img id="clock" src="timer.svg" width="100%">
	
</div>

<div id="controls_container">
	
	<input onkeypress="EnterInitTimer()" value="" id="SetTimer_input" maxlength="2" autofocus > <label>Min</label> 
	<button class="btn_style-start" id="StartTimer_btn">START</button>

	<br>
	<input id="spotify_id" placeholder="Add Spotify playlist Id...">
	<button class="spotify_btn" id="spotify_btn">Import</button>
	<button class="spotify_btn" id="spotify_reset_btn">Reset</button>


<audio id="alarm" src="alarm.mp3" ></audio>


	<iframe id="spotify_player" src="" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>


</div>


<script>


	var timer_value = localStorage.getItem('time_value');

	if (timer_value) {
			document.getElementById('SetTimer_input').value = timer_value;
		} else {
		}





	var LocalPlaylist = localStorage.getItem('myPlaylist');

		if (LocalPlaylist) {
			var New_playlist = 'https://open.spotify.com/embed/playlist/' + LocalPlaylist;
			document.getElementById('spotify_player').src = New_playlist;
		} else {
			SetDefaultSpotify();
		}


	
	document.getElementById('spotify_btn').addEventListener('click', function() {

			var playlist = document.getElementById('spotify_id').value;

			if (playlist) {
			var New_playlist = 'https://open.spotify.com/embed/playlist/' + playlist;
			document.getElementById('spotify_player').src = New_playlist;

			localStorage.setItem('myPlaylist', playlist);
			document.getElementById('spotify_id').value = '';
			}
			
		});
		
	document.getElementById('spotify_reset_btn').addEventListener('click', function() {
			SetDefaultSpotify();
		});


	function SetDefaultSpotify() {
		var default_playlist = '5WgW1FD8eOYaY18vGP2tzl';

		document.getElementById('spotify_player').src = 'https://open.spotify.com/embed/playlist/' + default_playlist;
		localStorage.setItem('myPlaylist', default_playlist);
		document.getElementById('spotify_id').value = '';
	}


	function EnterInitTimer() {
		var enterKey = window.event.keyCode;
		if (enterKey == 13) {
			InitTimer();
		}
	}

	document.getElementById('StartTimer_btn').addEventListener('click', function() {
		InitTimer();
	});




	function InitTimer() {

		var InitValue = document.getElementById('SetTimer_input').value;

			if (InitValue <= 0 || InitValue > 60) {
				document.getElementById('SetTimer_input').value = '';
			} else {
				TimerValue = 100 - ((InitValue * 60) / 36); // muuta minuutit sekunneiksi ja sekunnit prosenteiksi
				localStorage.setItem('time_value', InitValue);
				StartTimer(TimerValue, InitValue);
			}




	}



	function StartTimer(Timer_Value, time_count_min) {
		console.log(Timer_Value);

		var StarStopBtn = document.getElementById('StartTimer_btn').innerHTML;
		 var btn_classlist = document.getElementById("StartTimer_btn");

		if (StarStopBtn == 'START') {
			StarStopBtn = 'STOP';

				const pointer = document.getElementById('pie');
			 	document.getElementById('timer_out').style.display = 'none';
					btn_classlist.classList.toggle("btn_style-stop");
				document.getElementById('StartTimer_btn').innerHTML = StarStopBtn;
				var time_count_sek = 0;

				document.Interval = setInterval(StartInterval, 1000);
				

				function StartInterval() {

					
					time_count_sek = time_count_sek - 1;

				 if (time_count_sek < 0) {
						time_count_sek = 59;
						time_count_min = time_count_min - 1;
					}

					var count = time_count_min + 'min ' + time_count_sek + 'sek';
					document.getElementById('timer_count').innerHTML = count; // timer count

					Timer_Value = Timer_Value + 0.027777777;
					var NewStatevalue = 'conic-gradient(white ' + Timer_Value + '%, red ' + Timer_Value + '%)';

					pointer.style.background = NewStatevalue; // turn clock forward
					console.log(Timer_Value);

					if (time_count_min == 0 && time_count_sek == 0) {
						clearInterval(document.Interval);
						playAlarm();

						btn_classlist.classList.toggle("btn_style-stop");
						document.getElementById('timer_out').style.display = 'block';
						document.getElementById('StartTimer_btn').innerHTML = 'START';
					}
				}

		

	} else {

			btn_classlist.classList.toggle("btn_style-stop");
			clearInterval(document.Interval);

			StarStopBtn = 'START';
			document.getElementById('StartTimer_btn').innerHTML = StarStopBtn;
		} 
	
	}


	function playAlarm() {
		var alarm = document.getElementById("myAudio");
			//alarm.volume = 0.1;
			alarm.play();
		setTimeout(function() {
			alarm.pause();
		}, 5000);
	}



window.addEventListener("load", function() {
  // CHROME
  if (navigator.userAgent.indexOf("Chrome") != -1 ) {
    document.getElementById('browser_note').style.display = 'none';
  }
  // FIREFOX
  else if (navigator.userAgent.indexOf("Firefox") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // INTERNET EXPLORER
  else if (navigator.userAgent.indexOf("MSIE") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // EDGE
  else if (navigator.userAgent.indexOf("Edge") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // SAFARI
  else if (navigator.userAgent.indexOf("Safari") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // OPERA
  else if (navigator.userAgent.indexOf("Opera") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // YANDEX BROWSER
  else if (navigator.userAgent.indexOf("Opera") != -1 ) {
    document.getElementById('browser_note').style.display = 'block';
  }
  // OTHERS
  else {
    
  }
});










</script>


<audio id="myAudio" loop="loop">
  <source src="alarm.mp3" type="audio/mpeg">
</audio>

</body>
</html>